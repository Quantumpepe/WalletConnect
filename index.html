
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>WalletConnect Beispiel</title>
  <!-- WalletConnect und QR-Code-Modal einbinden -->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/client@1.6.6/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/qrcode-modal@1.6.6/dist/umd/index.min.js"></script>
</head>
<body>
  <!-- Dropdown für Chain-Auswahl -->
  <label for="chainSelect">Wähle dein Netzwerk:</label>
  <select id="chainSelect">
      <!-- Chain-ID: Ethereum Mainnet (1), Binance Smart Chain (56), Polygon (137) -->
      <option value="1">ETH (Ethereum Mainnet)</option>
      <option value="56">BNB (Binance Smart Chain)</option>
      <option value="137">POL (Polygon Mainnet)</option>
  </select>

  <!-- Verbindungsbutton -->
  <button id="connectButton">WalletConnect verbinden</button>

  <script>
    // Hole die Elemente aus dem DOM
    const connectButton = document.getElementById('connectButton');
    const chainSelect = document.getElementById('chainSelect');

    // Klick-Event für den Button
    connectButton.addEventListener('click', async () => {
      // Instanziere WalletConnect unter Nutzung der eingebundenen Bibliotheken.
      const WalletConnect = window.WalletConnect.default;
      const QrcodeModal = window.WalletConnectQRCodeModal.default;

      // Erstelle einen neuen WalletConnect-Client (Connector)
      const connector = new WalletConnect({
        bridge: 'https://bridge.walletconnect.org', // Standard-Bridge
        qrcodeModal: QrcodeModal,                  // Modal zur Anzeige des QR-Codes
      });

      // Prüfe, ob bereits eine Verbindung besteht
      if (!connector.connected) {
        // Erstelle eine neue Session, wodurch der QR-Code angezeigt wird
        await connector.createSession();
      }

      // Abonniere Events, um Verbindungsänderungen zu verwalten
      connector.on("connect", (error, payload) => {
        if (error) throw error;

        // Extrahiere Accounts und chainId aus der Payload
        const { accounts, chainId } = payload.params[0];
        console.log("Verbundene Accounts:", accounts);
        console.log("Verbundene Chain-ID:", chainId);
      });

      connector.on("session_update", (error, payload) => {
        if (error) throw error;

        // Extrahiere aktualisierte Accounts und chainId
        const { accounts, chainId } = payload.params[0];
        console.log("Session aktualisiert – Accounts:", accounts, "Chain-ID:", chainId);
      });

      connector.on("disconnect", (error, payload) => {
        if (error) throw error;
        console.log("Wallet disconnected");
      });

      // Lese die Chain-ID aus der Dropdown-Auswahl
      const selectedChainId = parseInt(chainSelect.value);
      console.log("Ausgewählte Chain-ID (aus Dropdown):", selectedChainId);

      /* 
         Hinweis:
         WalletConnect v1 übernimmt standardmäßig die Netzwerkauswahl über die Wallet des Users.
         Falls dein dApp-Flow einen Wechsel des Netzwerks erfordert, musst du dies über den entsprechenden Provider (z. B. Web3/Ethers)
         und die entsprechenden Methoden (wie EIP-3326: wallet_switchEthereumChain) anstoßen.
         Die hier gewonnene Chain-ID aus dem Dropdown kann als Grundlage dienen, um die gewünschte Logik zu implementieren.
      */
    });
  </script>
</body>
</html>
